# Цель
Запустить бота балансировки на 4-м счете Тинькофф. Обеспечить корректный выбор `ACCOUNT_ID` и безопасный запуск.

## Что хочет пользователь
- Запуск старого проекта на 4-м счете (если токен ограничен одним счетом, понять, что указывать в `ACCOUNT_ID`).

## Принятые решения (foundation-first)
- Реализован безопасный выбор счета:
  - `ACCOUNT_ID` принимает: точный `id`, `BROKER`, `ISS`, `INDEX:N` или просто число строкой `N` (короткая форма `INDEX:N`).
  - Добавлен скрипт `npm run accounts` для вывода списка счетов с индексами и `id`.
  - Улучшена устойчивость к формату ответа `users.getAccounts` (разные поля `id/accountId/account_id`, обёртка `{ accounts }`).

## Изменения в коде
- `src/provider/index.ts` — переработан `getAccountId`:
  - Поддержка `INDEX:N` и короткой формы `N`.
  - Корректный маппинг по типам: `BROKER` → type 1, `ISS` → type 2.
  - Безопасная выборка `id` по нескольким возможным названиям полей.
- `src/utils/index.ts` — добавлен `listAccounts(usersClient)` для получения и форматирования списка счетов.
- `src/index.ts` — добавлен флаг `--list-accounts` (использует `dotenv`, `createSdk`, `listAccounts`).
- `package.json` — добавлен скрипт `accounts`.
- `.env-example` и `readme.md` — обновлены инструкции по `ACCOUNT_ID`.

## Пути, которые уже проверены (не тратить время заново)
- `src/provider/index.ts`
- `src/index.ts`
- `src/utils/index.ts`
- `src/config.ts`
- `package.json`
- `readme.md`

## Что делать дальше
1) Установить зависимости: `npm i`.
2) Посмотреть список счетов: `npm run accounts`.
3) Выбрать 4-й счет из списка → в `.env` указать `ACCOUNT_ID=INDEX:3` (или просто `ACCOUNT_ID=3`).
   - Если токен ограничен одним счетом, можно использовать `ACCOUNT_ID=BROKER` или `ACCOUNT_ID=ISS`, либо точный `id` из вывода.
4) Запустить бота: `npm run start`.
5) В логах убедиться, что используется правильный `accountId` и портфель корректно считывается.

## Примечания
- Бот работает корректно только с рублёвыми активами. Проверьте `DESIRED_WALLET` в `src/config.ts`.
- `.env` не коммитим. Используем `.env-example` как образец.


