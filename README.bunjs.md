# Tinkoff Invest ETF Balancer Bot - Bun.js Edition

## üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Bun.js –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω —Å Node.js + ts-node –Ω–∞ Bun.js –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —É–ø—Ä–æ—â–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Bun.js

- **üöÄ –°–∫–æ—Ä–æ—Å—Ç—å**: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TypeScript –±–µ–∑ ts-node
- **‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- **üîÑ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å**: ES –º–æ–¥—É–ª–∏ –≤–º–µ—Å—Ç–æ CommonJS
- **üéØ –£–ø—Ä–æ—â–µ–Ω–∏–µ**: –ú–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **üîí –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Bun.js**: –≤–µ—Ä—Å–∏—è 1.0.0 –∏–ª–∏ –≤—ã—à–µ
- **Node.js**: –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–∑–∞–º–µ–Ω–µ–Ω –Ω–∞ Bun.js)

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bun.js

```bash
# macOS/Linux
curl -fsSL https://bun.sh/install | bash

# Windows (—á–µ—Ä–µ–∑ WSL)
curl -fsSL https://bun.sh/install | bash

# –î–æ–±–∞–≤–∏—Ç—å –≤ PATH
export PATH="$HOME/.bun/bin:$PATH"
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
bun install
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞
bun run start

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
bun run dev

# –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—á–µ—Ç–æ–≤
bun run accounts

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω–æ–π –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ ETF
bun run etf-cap

# –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ ETF
bun run poll:metrics

# –¢–µ—Å—Ç –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏
bun run test:margin

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
bun run build

# –û—á–∏—Å—Ç–∫–∞
bun run clean
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°–∫—Ä–∞–ø–∏–Ω–≥ –Ω–æ–≤–æ—Å—Ç–µ–π –¢-–ë–∞–Ω–∫–∞
bun run scrape:tbank:news TRUR --limit=10

# –ê–Ω–∞–ª–∏–∑ –Ω–æ–≤–æ—Å—Ç–µ–π
bun run analyze:news TRUR --limit=10

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–∫—Ü–∏–π
bun run update:shares TRUR

# –°–±–æ—Ä –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫
bun run poll:metrics:all
```

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- **–°–±–æ—Ä–∫–∞**: 522 –º–æ–¥—É–ª—è –∑–∞ 107ms (–±—ã—Å—Ç—Ä–µ–µ —á–µ–º ts-node)
- **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ TypeScript**: –Ω–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–µ–∑ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: —á–µ—Ä–µ–∑ bun install

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Node.js

| –ú–µ—Ç—Ä–∏–∫–∞ | Node.js + ts-node | Bun.js |
|---------|-------------------|---------|
| –í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ | ~2-3 —Å–µ–∫—É–Ω–¥—ã | ~107ms |
| –ó–∞–ø—É—Å–∫ TypeScript | –¢—Ä–µ–±—É–µ—Ç –∫–æ–º–ø–∏–ª—è—Ü–∏—é | –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ |
| –ü–∞–º—è—Ç—å | –ë–æ–ª—å—à–µ | –ú–µ–Ω—å—à–µ |
| –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | –ë–æ–ª—å—à–µ | –ú–µ–Ω—å—à–µ |

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### bunfig.toml

```toml
[install]
registry = "https://registry.bun.sh/"

[test]
preload = ["./src/test-setup.ts"]

[run]
bun = true

[install.cache]
dir = ".bun"

[install.lockfile]
format = "bun"
```

### tsconfig.json

–û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ JavaScript:
- Target: ES2022
- Module: ESNext
- ModuleResolution: bundler
- –°—Ç—Ä–æ–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ TypeScript

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
bun test

# –ó–∞–ø—É—Å–∫ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
bun test --timeout 10000

# –ó–∞–ø—É—Å–∫ –≤ watch —Ä–µ–∂–∏–º–µ
bun test --watch
```

## üì¶ –°–±–æ—Ä–∫–∞

```bash
# –°–±–æ—Ä–∫–∞ –¥–ª—è Bun.js
bun run build

# –†–µ–∑—É–ª—å—Ç–∞—Ç: ./dist/index.js
```

## üîç –û—Ç–ª–∞–¥–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥—á–∏–∫–æ–º
bun run --inspect ./src/index.ts

# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥—á–∏–∫–æ–º –∏ –æ–∂–∏–¥–∞–Ω–∏–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
bun run --inspect-wait ./src/index.ts
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: "module is not defined"

**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–∏—Ç–µ `require.main === module` –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É `process.argv[1]`:

```typescript
// –ë—ã–ª–æ (CommonJS)
const isMain = require.main === module;

// –°—Ç–∞–ª–æ (ES –º–æ–¥—É–ª–∏)
const isMain = process.argv[1]?.endsWith('filename.ts');
```

### –ü—Ä–æ–±–ª–µ–º–∞: "require is not defined"

**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–∏—Ç–µ `require()` –Ω–∞ `import`:

```typescript
// –ë—ã–ª–æ (CommonJS)
const debug = require('debug')('bot');

// –°—Ç–∞–ª–æ (ES –º–æ–¥—É–ª–∏)
import debug from 'debug';
const debugBot = debug('bot');
```

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Bun.js Documentation](https://bun.com/docs)
- [Bun.js CLI Reference](https://bun.com/docs/cli)
- [Bun.js TypeScript Support](https://bun.com/docs/runtime/typescript)
- [Migration Guide](https://bun.com/docs/guides/migrate-from-nodejs)

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞ —Å–ª–µ–¥—É–π—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º ES –º–æ–¥—É–ª–µ–π:

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `import` –≤–º–µ—Å—Ç–æ `require`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `export` –≤–º–µ—Å—Ç–æ `module.exports`
3. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ `process.argv[1]` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
4. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å `bun run` –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

## üéØ Roadmap

- [x] –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Bun.js
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
- [x] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ Production Ready  
**–í–µ—Ä—Å–∏—è Bun.js**: 1.2.20  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: $(date)
